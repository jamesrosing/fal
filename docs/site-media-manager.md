# Site Media Manager

The Site Media Manager is a comprehensive solution for managing media assets across the site. It follows Next Cloudinary best practices and provides a user-friendly interface for uploading, replacing, and previewing media assets.

## Features

- **Organized Media Structure**: Media assets are organized by section and area, making it easy to find and manage specific assets.
- **Optimized Image Delivery**: Uses Next Cloudinary for optimized image delivery with responsive sizes and modern formats.
- **Upload Widget**: Integrated Cloudinary upload widget for easy uploading of new assets.
- **Preview Functionality**: Preview media assets with optimized delivery before publishing.
- **Responsive Design**: The interface is responsive and works on all devices.

## Architecture

The Site Media Manager consists of the following components:

1. **Media Map**: A structured representation of all media placeholders organized by section and area.
2. **Media Assets**: Associations between media placeholders and Cloudinary public IDs stored in Supabase.
3. **SiteMediaManager Component**: A React component that provides the user interface for managing media assets.
4. **Admin Page**: A Next.js page that uses the SiteMediaManager component.

## Usage

### Accessing the Media Manager

The Site Media Manager is available at `/admin/media`. You need to be logged in as an admin to access this page.

### Managing Media Assets

1. **Browsing Assets**: Navigate through the sections and areas to find the media assets you want to manage.
2. **Viewing Asset Details**: Click on an asset to view its details, including dimensions and path.
3. **Uploading New Assets**: Click the "Upload New Image" button to upload a new image for a placeholder.
4. **Replacing Existing Assets**: Select an asset and click "Upload New Image" to replace it.

## Implementation Details

### Media Map Generation

The media map is generated by scanning the codebase for media placeholders. This is done by the `generate-media-map.js` script, which looks for patterns like:

- `getCloudinaryUrl('placeholder-id')`
- `useMediaAsset('placeholder-id')`
- `<CldImage src="placeholder-id" />`

The script organizes the placeholders by section and area based on their location in the codebase.

### Media Asset Storage

Media assets are stored in Supabase in the `media_assets` table with the following structure:

- `id`: A unique identifier for the asset.
- `placeholder_id`: The ID of the media placeholder.
- `cloudinary_id`: The Cloudinary public ID of the asset.
- `area`: The area of the site where the asset is used.
- `created_at`: The date and time when the asset was created.
- `updated_at`: The date and time when the asset was last updated.

### Next Cloudinary Integration

The Site Media Manager uses Next Cloudinary for optimized image delivery. It follows the best practices from the [Next Cloudinary documentation](https://next.cloudinary.dev/):

- **Responsive Images**: Images are delivered with responsive sizes and breakpoints.
- **Modern Formats**: Images are automatically converted to modern formats like WebP and AVIF.
- **Lazy Loading**: Images are lazy-loaded for better performance.
- **Placeholder Images**: Low-quality image placeholders are used while images are loading.

## API Reference

### Media Map API

- `getMediaMap()`: Get the media map from the data file.
- `getMediaPlaceholder(id)`: Get a specific media placeholder by ID.

### Media Assets API

- `getMediaAsset(placeholderId)`: Get a media asset by placeholder ID.
- `getAllMediaAssets()`: Get all media assets.
- `updateMediaAsset(placeholderId, cloudinaryId)`: Update a media asset.
- `deleteMediaAsset(placeholderId)`: Delete a media asset.

## Best Practices

1. **Use Descriptive IDs**: Use descriptive IDs for media placeholders, like `hero/hero-banner` or `about/team-photo`.
2. **Organize by Section and Area**: Organize media placeholders by section and area to make them easier to find.
3. **Set Appropriate Dimensions**: Set appropriate dimensions for media placeholders based on their usage.
4. **Use Responsive Images**: Use responsive images with appropriate breakpoints for better performance.
5. **Optimize for Mobile**: Ensure that images are optimized for mobile devices.

## Troubleshooting

### Common Issues

1. **Media Map Not Found**: If the media map is not found, run the `generate-media-map` script to generate it.
2. **Media Asset Not Found**: If a media asset is not found, check if it exists in the `media_assets` table.
3. **Upload Failed**: If an upload fails, check the Cloudinary upload preset and folder configuration.

### Debugging

1. **Check the Console**: Check the browser console for error messages.
2. **Check the Network Tab**: Check the network tab for failed requests.
3. **Check the Supabase Logs**: Check the Supabase logs for database errors.
4. **Check the Cloudinary Logs**: Check the Cloudinary logs for upload errors.

## Resources

- [Next Cloudinary Documentation](https://next.cloudinary.dev/)
- [Supabase Documentation](https://supabase.io/docs)
- [Next.js Documentation](https://nextjs.org/docs) 